# Employer Application Management System - Simplified Implementation Plan
**Focus**: Fast, practical implementation of core employer features for managing job applications

## 🎯 Overview
Create a streamlined employer application management system that allows employers to:
- View all applications for their jobs
- Review individual applications with cover letters and resumes
- Update application statuses efficiently
- Basic filtering and sorting capabilities

**Implementation Time**: 1-2 days (instead of full Phase 3 complexity)

## 🚀 Implementation Plan

### Step 1: Applications Management Page
**Priority**: HIGH
**Time**: 3-4 hours

#### **File**: `src/app/dashboard/jobs/[id]/applications/page.tsx`
```tsx
import { notFound, redirect } from 'next/navigation'
import { createClient } from '@/lib/supabase/server'
import { applicationsServer } from '@/lib/database/applications'
import { ApplicationsManagementList } from '@/components/applications/applications-management-list'

interface ApplicationsPageProps {
  params: { id: string }
  searchParams: { status?: string; sort?: string }
}

export async function generateMetadata({ params }: ApplicationsPageProps) {
  const supabase = await createClient()
  const { data: job } = await supabase
    .from('jobs')
    .select('title, company')
    .eq('id', params.id)
    .single()

  return {
    title: `Applications - ${job?.title || 'Job'} | Dashboard`,
    description: `Manage applications for ${job?.title || 'your job'}`
  }
}

export default async function ApplicationsPage({ params, searchParams }: ApplicationsPageProps) {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()

  if (!user) {
    redirect('/auth/login')
  }

  // Get job details and verify ownership
  const { data: job, error: jobError } = await supabase
    .from('jobs')
    .select('*')
    .eq('id', params.id)
    .eq('user_id', user.id)
    .single()

  if (jobError || !job) {
    notFound()
  }

  // Get applications with filters
  const statusFilter = searchParams.status?.split(',') || []
  const { data: applications, error: appsError } = await applicationsServer.getByJob(
    params.id, 
    user.id, 
    { status: statusFilter.length > 0 ? statusFilter as any : undefined }
  )

  if (appsError) {
    throw new Error('Failed to load applications')
  }

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold">{job.title}</h1>
          <p className="text-muted-foreground">
            {job.company} • {applications?.length || 0} applications
          </p>
        </div>
      </div>

      <ApplicationsManagementList
        jobId={job.id}
        applications={applications || []}
        initialFilters={{
          status: statusFilter,
          sort: searchParams.sort || 'newest'
        }}
      />
    </div>
  )
}
```

### Step 2: Applications Management List Component
**Priority**: HIGH  
**Time**: 4-5 hours

#### **File**: `src/components/applications/applications-management-list.tsx`
```tsx
'use client'

import { useState } from 'react'
import { useRouter, useSearchParams } from 'next/navigation'
import { Card } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Button } from '@/components/ui/button'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { Input } from '@/components/ui/input'
import { Eye, FileText, Download, Filter } from 'lucide-react'
import { ApplicationReviewModal } from './application-review-modal'
import { formatDistanceToNow } from 'date-fns'
import { getResumeDownloadUrlClient } from '@/lib/storage/resume-storage'
import { useToast } from '@/lib/toast-context'
import type { JobApplicationWithProfile } from '@/types/database'

interface ApplicationsManagementListProps {
  jobId: string
  applications: JobApplicationWithProfile[]
  initialFilters: {
    status: string[]
    sort: string
  }
}

export function ApplicationsManagementList({ 
  jobId, 
  applications, 
  initialFilters 
}: ApplicationsManagementListProps) {
  const router = useRouter()
  const searchParams = useSearchParams()
  const { toast } = useToast()
  const [selectedApplication, setSelectedApplication] = useState<JobApplicationWithProfile | null>(null)
  const [statusFilter, setStatusFilter] = useState(initialFilters.status.join(',') || 'all')
  const [sortBy, setSortBy] = useState(initialFilters.sort)
  const [searchTerm, setSearchTerm] = useState('')

  // Filter applications
  const filteredApplications = applications.filter(app => {
    const matchesStatus = statusFilter === 'all' || statusFilter.split(',').includes(app.status)
    const matchesSearch = !searchTerm || 
      app.user_profiles.full_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      app.cover_letter?.toLowerCase().includes(searchTerm.toLowerCase())
    
    return matchesStatus && matchesSearch
  })

  // Sort applications
  const sortedApplications = [...filteredApplications].sort((a, b) => {
    switch (sortBy) {
      case 'newest':
        return new Date(b.applied_at).getTime() - new Date(a.applied_at).getTime()
      case 'oldest':
        return new Date(a.applied_at).getTime() - new Date(b.applied_at).getTime()
      case 'name':
        const nameA = a.user_profiles.full_name || ''
        const nameB = b.user_profiles.full_name || ''
        return nameA.localeCompare(nameB)
      case 'status':
        return a.status.localeCompare(b.status)
      default:
        return 0
    }
  })

  const updateURL = (newStatus: string, newSort: string) => {
    const params = new URLSearchParams()
    if (newStatus !== 'all') params.set('status', newStatus)
    if (newSort !== 'newest') params.set('sort', newSort)
    
    const queryString = params.toString()
    router.push(`/dashboard/jobs/${jobId}/applications${queryString ? `?${queryString}` : ''}`)
  }

  const handleStatusFilterChange = (value: string) => {
    setStatusFilter(value)
    updateURL(value, sortBy)
  }

  const handleSortChange = (value: string) => {
    setSortBy(value)
    updateURL(statusFilter, value)
  }

  return (
    <div className="space-y-6">
      {/* Filters */}
      <Card className="p-4">
        <div className="flex flex-col sm:flex-row gap-4 items-start sm:items-center">
          <div className="flex-1">
            <Input
              placeholder="Search applications..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="max-w-sm"
            />
          </div>
          
          <div className="flex gap-2">
            <Select value={statusFilter} onValueChange={handleStatusFilterChange}>
              <SelectTrigger className="w-40">
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="all">All Status</SelectItem>
                <SelectItem value="pending">Pending</SelectItem>
                <SelectItem value="reviewing">Reviewing</SelectItem>
                <SelectItem value="shortlisted">Shortlisted</SelectItem>
                <SelectItem value="accepted">Accepted</SelectItem>
                <SelectItem value="rejected">Rejected</SelectItem>
              </SelectContent>
            </Select>

            <Select value={sortBy} onValueChange={handleSortChange}>
              <SelectTrigger className="w-32">
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="newest">Newest</SelectItem>
                <SelectItem value="oldest">Oldest</SelectItem>
                <SelectItem value="name">Name</SelectItem>
                <SelectItem value="status">Status</SelectItem>
              </SelectContent>
            </Select>
          </div>
        </div>
      </Card>

      {/* Results Summary */}
      <div className="text-sm text-muted-foreground">
        Showing {sortedApplications.length} of {applications.length} applications
      </div>

      {/* Applications List */}
      <div className="space-y-4">
        {sortedApplications.length === 0 ? (
          <Card className="p-8 text-center">
            <p className="text-muted-foreground">No applications found matching your criteria.</p>
          </Card>
        ) : (
          sortedApplications.map((application) => (
            <ApplicationCard
              key={application.id}
              application={application}
              onViewDetails={() => setSelectedApplication(application)}
            />
          ))
        )}
      </div>

      {/* Application Review Modal */}
      {selectedApplication && (
        <ApplicationReviewModal
          application={selectedApplication}
          jobId={jobId}
          isOpen={!!selectedApplication}
          onClose={() => setSelectedApplication(null)}
          onStatusUpdate={() => {
            setSelectedApplication(null)
            router.refresh()
          }}
        />
      )}
    </div>
  )
}

function ApplicationCard({ 
  application, 
  onViewDetails 
}: { 
  application: JobApplicationWithProfile
  onViewDetails: () => void
}) {
  const { toast } = useToast()
  const [isDownloadingResume, setIsDownloadingResume] = useState(false)

  const handleResumeDownload = async () => {
    if (!application.resume_file_path) return
    
    setIsDownloadingResume(true)
    try {
      const { url, error } = await getResumeDownloadUrlClient(application.resume_file_path)
      
      if (error) throw new Error(error)
      
      if (url) {
        window.open(url, '_blank')
      } else {
        throw new Error('No download URL received')
      }
    } catch (error) {
      toast.error('Download Failed', 'Unable to download resume. Please try again.')
    } finally {
      setIsDownloadingResume(false)
    }
  }

  const getStatusVariant = (status: string) => {
    switch (status) {
      case 'pending': return 'default'
      case 'reviewing': return 'info' as const
      case 'shortlisted': return 'success' as const
      case 'rejected': return 'error' as const
      case 'accepted': return 'success' as const
      default: return 'default'
    }
  }

  return (
    <Card className="p-6 hover:shadow-md transition-shadow">
      <div className="flex items-start justify-between">
        <div className="space-y-3 flex-1">
          <div className="flex items-start justify-between">
            <div>
              <h3 className="font-semibold text-lg">
                {application.user_profiles.full_name || 'Anonymous Applicant'}
              </h3>
              <p className="text-sm text-muted-foreground">
                Applied {formatDistanceToNow(new Date(application.applied_at), { addSuffix: true })}
              </p>
            </div>
            
            <div className="flex items-center gap-2">
              <Badge variant={getStatusVariant(application.status)}>
                {application.status.charAt(0).toUpperCase() + application.status.slice(1)}
              </Badge>
            </div>
          </div>

          {/* Cover Letter Preview */}
          {application.cover_letter && (
            <div className="bg-gray-50 p-3 rounded-md">
              <p className="text-sm text-gray-700 line-clamp-2">
                {application.cover_letter}
              </p>
            </div>
          )}

          {/* Actions */}
          <div className="flex items-center gap-2">
            <Button
              variant="outline"
              size="sm"
              onClick={onViewDetails}
              className="gap-2"
            >
              <Eye className="h-4 w-4" />
              Review Application
            </Button>

            {application.resume_file_path && (
              <Button
                variant="outline"
                size="sm"
                onClick={handleResumeDownload}
                disabled={isDownloadingResume}
                className="gap-2"
              >
                {isDownloadingResume ? (
                  <div className="animate-spin h-4 w-4 border border-current border-t-transparent rounded-full" />
                ) : (
                  <Download className="h-4 w-4" />
                )}
                Resume
              </Button>
            )}

            {application.cover_letter && (
              <Badge variant="outline" className="gap-1">
                <FileText className="h-3 w-3" />
                Cover Letter
              </Badge>
            )}
          </div>
        </div>
      </div>
    </Card>
  )
}
```

### Step 3: Application Review Modal
**Priority**: HIGH
**Time**: 3-4 hours

#### **File**: `src/components/applications/application-review-modal.tsx`
```tsx
'use client'

import { useState } from 'react'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Card } from '@/components/ui/card'
import { X, Download, FileText, User, Clock } from 'lucide-react'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { formatDistanceToNow } from 'date-fns'
import { applicationsServer } from '@/lib/database/applications'
import { getResumeDownloadUrlClient } from '@/lib/storage/resume-storage'
import { useToast } from '@/lib/toast-context'
import { useAuth } from '@/lib/auth/context'
import type { JobApplicationWithProfile, ApplicationStatus } from '@/types/database'

interface ApplicationReviewModalProps {
  application: JobApplicationWithProfile
  jobId: string
  isOpen: boolean
  onClose: () => void
  onStatusUpdate: () => void
}

export function ApplicationReviewModal({
  application,
  jobId,
  isOpen,
  onClose,
  onStatusUpdate
}: ApplicationReviewModalProps) {
  const { user } = useAuth()
  const { toast } = useToast()
  const [isUpdatingStatus, setIsUpdatingStatus] = useState(false)
  const [isDownloadingResume, setIsDownloadingResume] = useState(false)

  if (!isOpen) return null

  const handleStatusUpdate = async (newStatus: ApplicationStatus) => {
    if (!user) return

    setIsUpdatingStatus(true)
    try {
      const { error } = await applicationsServer.updateStatus(
        application.id,
        newStatus,
        user.id
      )

      if (error) {
        throw new Error(error.message)
      }

      toast.success('Status Updated', `Application status changed to ${newStatus}`)
      onStatusUpdate()
    } catch (error) {
      toast.error('Update Failed', 'Failed to update application status')
    } finally {
      setIsUpdatingStatus(false)
    }
  }

  const handleResumeDownload = async () => {
    if (!application.resume_file_path) return
    
    setIsDownloadingResume(true)
    try {
      const { url, error } = await getResumeDownloadUrlClient(application.resume_file_path)
      
      if (error) throw new Error(error)
      
      if (url) {
        window.open(url, '_blank')
      } else {
        throw new Error('No download URL received')
      }
    } catch (error) {
      toast.error('Download Failed', 'Unable to download resume')
    } finally {
      setIsDownloadingResume(false)
    }
  }

  const getStatusVariant = (status: string) => {
    switch (status) {
      case 'pending': return 'default'
      case 'reviewing': return 'info' as const
      case 'shortlisted': return 'success' as const
      case 'rejected': return 'error' as const
      case 'accepted': return 'success' as const
      default: return 'default'
    }
  }

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
      <Card className="w-full max-w-4xl mx-4 max-h-[90vh] overflow-hidden">
        {/* Header */}
        <div className="flex items-center justify-between p-6 border-b">
          <div className="flex items-center gap-4">
            <div>
              <h2 className="text-xl font-semibold">
                {application.user_profiles.full_name || 'Anonymous Applicant'}
              </h2>
              <div className="flex items-center gap-2 mt-1">
                <Badge variant={getStatusVariant(application.status)}>
                  {application.status.charAt(0).toUpperCase() + application.status.slice(1)}
                </Badge>
                <span className="text-sm text-muted-foreground">
                  Applied {formatDistanceToNow(new Date(application.applied_at), { addSuffix: true })}
                </span>
              </div>
            </div>
          </div>
          
          <Button variant="ghost" size="sm" onClick={onClose}>
            <X className="h-4 w-4" />
          </Button>
        </div>

        {/* Content */}
        <div className="p-6 overflow-y-auto max-h-[calc(90vh-200px)]">
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* Main Content */}
            <div className="lg:col-span-2 space-y-6">
              {/* Cover Letter */}
              {application.cover_letter && (
                <div>
                  <div className="flex items-center gap-2 mb-3">
                    <FileText className="h-5 w-5" />
                    <h3 className="text-lg font-medium">Cover Letter</h3>
                  </div>
                  <Card className="p-4">
                    <div className="prose prose-sm max-w-none">
                      <p className="whitespace-pre-wrap text-sm leading-relaxed">
                        {application.cover_letter}
                      </p>
                    </div>
                  </Card>
                </div>
              )}

              {/* Resume Section */}
              {application.resume_file_path && (
                <div>
                  <div className="flex items-center gap-2 mb-3">
                    <Download className="h-5 w-5" />
                    <h3 className="text-lg font-medium">Resume</h3>
                  </div>
                  <Card className="p-4">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-2">
                        <FileText className="h-4 w-4 text-muted-foreground" />
                        <span className="text-sm">Resume attached</span>
                      </div>
                      <Button
                        variant="outline"
                        size="sm"
                        onClick={handleResumeDownload}
                        disabled={isDownloadingResume}
                        className="gap-2"
                      >
                        {isDownloadingResume ? (
                          <div className="animate-spin h-4 w-4 border border-current border-t-transparent rounded-full" />
                        ) : (
                          <Download className="h-4 w-4" />
                        )}
                        Download Resume
                      </Button>
                    </div>
                  </Card>
                </div>
              )}
            </div>

            {/* Sidebar */}
            <div className="space-y-6">
              {/* Status Management */}
              <div>
                <h3 className="text-lg font-medium mb-3">Update Status</h3>
                <div className="space-y-3">
                  <Select
                    value={application.status}
                    onValueChange={(value: ApplicationStatus) => handleStatusUpdate(value)}
                    disabled={isUpdatingStatus}
                  >
                    <SelectTrigger>
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="pending">Pending</SelectItem>
                      <SelectItem value="reviewing">Under Review</SelectItem>
                      <SelectItem value="shortlisted">Shortlisted</SelectItem>
                      <SelectItem value="accepted">Accepted</SelectItem>
                      <SelectItem value="rejected">Rejected</SelectItem>
                    </SelectContent>
                  </Select>

                  {/* Quick Actions */}
                  <div className="grid grid-cols-2 gap-2">
                    <Button
                      variant="outline"
                      size="sm"
                      onClick={() => handleStatusUpdate('shortlisted')}
                      disabled={isUpdatingStatus || application.status === 'shortlisted'}
                    >
                      Shortlist
                    </Button>
                    <Button
                      variant="outline"
                      size="sm"
                      onClick={() => handleStatusUpdate('rejected')}
                      disabled={isUpdatingStatus || application.status === 'rejected'}
                    >
                      Reject
                    </Button>
                  </div>
                </div>
              </div>

              {/* Application Details */}
              <div>
                <h3 className="text-lg font-medium mb-3">Application Details</h3>
                <div className="space-y-3 text-sm">
                  <div className="flex items-center gap-2">
                    <User className="h-4 w-4 text-muted-foreground" />
                    <span>Applicant ID: {application.applicant_id}</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <Clock className="h-4 w-4 text-muted-foreground" />
                    <span>
                      Applied: {new Date(application.applied_at).toLocaleDateString()}
                    </span>
                  </div>
                  {application.updated_at !== application.applied_at && (
                    <div className="flex items-center gap-2">
                      <Clock className="h-4 w-4 text-muted-foreground" />
                      <span>
                        Updated: {new Date(application.updated_at).toLocaleDateString()}
                      </span>
                    </div>
                  )}
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Footer */}
        <div className="flex justify-end p-4 border-t bg-gray-50">
          <Button variant="outline" onClick={onClose}>
            Close
          </Button>
        </div>
      </Card>
    </div>
  )
}
```

### Step 4: Navigation Integration
**Priority**: MEDIUM
**Time**: 30 minutes

Add navigation link to job cards in the employer dashboard:

#### **File**: `src/components/dashboard/job-card.tsx` (modify existing)
Add "Manage Applications" button:
```tsx
// Add this to the existing job card actions
{isEmployer && (
  <Button
    variant="outline"
    size="sm"
    asChild
    className="gap-2"
  >
    <Link href={`/dashboard/jobs/${job.id}/applications`}>
      <Users className="h-4 w-4" />
      Applications ({applicationCount || 0})
    </Link>
  </Button>
)}
```

## 🗂️ Required Types Extension

#### **File**: `types/database.ts` (add if not existing)
```typescript
export type JobApplicationWithProfile = JobApplication & {
  user_profiles: {
    full_name: string | null
    user_type: UserType
  }
  jobs: {
    id: string
    title: string
    company: string
  }
}
```

## ✅ Implementation Checklist

### Core Features (Must Have)
- [ ] Applications management page route (`/dashboard/jobs/[id]/applications`)
- [ ] Applications list with filtering (by status)
- [ ] Application review modal with cover letter and resume
- [ ] Status update functionality
- [ ] Resume download capability
- [ ] Basic sorting (newest, oldest, by name, by status)
- [ ] Search functionality

### Nice to Have (Later)
- [ ] Bulk status updates (can be added later)
- [ ] Application analytics (can be added later)
- [ ] Email notifications (can be added later)
- [ ] Export functionality (can be added later)

## 🎯 Success Criteria
- ✅ Employers can view all applications for their jobs
- ✅ Employers can review individual applications with full details
- ✅ Employers can update application statuses  
- ✅ Employers can download applicant resumes
- ✅ Employers can filter and search applications
- ✅ Mobile-responsive design

## 📈 Implementation Timeline
- **Day 1**: Steps 1-2 (Page + List Component) - 6-8 hours
- **Day 2**: Steps 3-4 (Modal + Navigation) - 4-5 hours
- **Total**: 10-13 hours (1-2 days)

This simplified plan focuses on delivering the core employer application management functionality quickly without the complexity of real-time notifications, advanced analytics, or bulk operations that can be added later if needed.