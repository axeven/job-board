# 3.3 Job Detail Page Implementation Plan

## Overview
Create dynamic job detail pages at `/jobs/[id]` that display complete job information with proper SEO, error handling, and navigation features.

## Technical Requirements

### 1. Dynamic Route Structure
- **File**: `src/app/jobs/[id]/page.tsx`
- **Route**: `/jobs/[id]` where `id` is the job UUID
- **Rendering**: Server-side rendering with ISR for performance

### 2. Database Query Functions
- **File**: `src/lib/database/jobs.ts` (extend existing)
```typescript
export async function getJobById(id: string): Promise<Job | null> {
  const { data, error } = await supabase
    .from('jobs')
    .select('*')
    .eq('id', id)
    .single()
  
  if (error) {
    if (error.code === 'PGRST116') {
      return null // Job not found
    }
    throw error
  }
  
  return data
}

export async function getAllJobIds(): Promise<string[]> {
  const { data, error } = await supabase
    .from('jobs')
    .select('id')
  
  if (error) throw error
  return data?.map(job => job.id) || []
}
```

### 3. Page Component Structure
- **File**: `src/app/jobs/[id]/page.tsx`
```typescript
interface JobDetailPageProps {
  params: { id: string }
}

export async function generateStaticParams() {
  const jobIds = await getAllJobIds()
  return jobIds.map(id => ({ id }))
}

export async function generateMetadata({ params }: JobDetailPageProps): Promise<Metadata> {
  const job = await getJobById(params.id)
  
  if (!job) {
    return {
      title: 'Job Not Found',
      description: 'The requested job posting could not be found.'
    }
  }
  
  return {
    title: `${job.title} at ${job.company}`,
    description: `${job.description.substring(0, 160)}...`,
    openGraph: {
      title: `${job.title} at ${job.company}`,
      description: job.description.substring(0, 200),
      type: 'article'
    }
  }
}

export default async function JobDetailPage({ params }: JobDetailPageProps) {
  const job = await getJobById(params.id)
  
  if (!job) {
    notFound()
  }
  
  return <JobDetailView job={job} />
}
```

### 4. Job Detail View Component
- **File**: `src/components/jobs/job-detail-view.tsx`
```typescript
interface JobDetailViewProps {
  job: Job & {
    user_id: string
    created_at: string
    updated_at: string
  }
}

export function JobDetailView({ job }: JobDetailViewProps) {
  return (
    <article className="max-w-4xl mx-auto">
      <JobDetailHeader job={job} />
      <JobDetailContent job={job} />
      <JobDetailActions job={job} />
      <JobDetailNavigation />
    </article>
  )
}
```

### 5. Sub-Components

#### Job Detail Header
- **File**: `src/components/jobs/job-detail-header.tsx`
- **Features**:
  - Job title and company name
  - Location and job type badges
  - Posted date and last updated
  - Share functionality
```typescript
export function JobDetailHeader({ job }: { job: Job }) {
  return (
    <header className="border-b pb-6 mb-8">
      <div className="flex justify-between items-start">
        <div>
          <h1 className="text-3xl font-bold text-gray-900">{job.title}</h1>
          <p className="text-xl text-gray-600 mt-2">{job.company}</p>
          <div className="flex items-center gap-4 mt-4">
            <JobTypeBadge type={job.job_type} />
            <LocationBadge location={job.location} />
            <PostedDate date={job.created_at} />
          </div>
        </div>
        <ShareButton job={job} />
      </div>
    </header>
  )
}
```

#### Job Detail Content
- **File**: `src/components/jobs/job-detail-content.tsx`
- **Features**:
  - Rich text job description rendering
  - Responsive typography
  - Code syntax highlighting (if applicable)
```typescript
export function JobDetailContent({ job }: { job: Job }) {
  return (
    <main className="prose prose-lg max-w-none">
      <section>
        <h2>Job Description</h2>
        <div 
          className="whitespace-pre-wrap"
          dangerouslySetInnerHTML={{ __html: sanitizeHtml(job.description) }}
        />
      </section>
    </main>
  )
}
```

#### Job Detail Actions
- **File**: `src/components/jobs/job-detail-actions.tsx`
- **Features**:
  - Apply/Contact button
  - Save job functionality (future enhancement)
  - Report job option
```typescript
export function JobDetailActions({ job }: { job: Job }) {
  return (
    <aside className="mt-8 p-6 bg-gray-50 rounded-lg">
      <div className="flex flex-col sm:flex-row gap-4">
        <ApplyButton job={job} />
        <SaveJobButton jobId={job.id} />
        <ShareDropdown job={job} />
      </div>
      
      <div className="mt-6 pt-6 border-t">
        <ReportJobLink jobId={job.id} />
      </div>
    </aside>
  )
}
```

### 6. Navigation Components

#### Back Navigation
- **File**: `src/components/jobs/job-detail-navigation.tsx`
- **Features**:
  - Back to job listings
  - Previous/Next job navigation
  - Breadcrumb navigation
```typescript
export function JobDetailNavigation() {
  return (
    <nav className="mt-8 pt-6 border-t">
      <div className="flex justify-between items-center">
        <BackToJobsButton />
        <JobNavigationButtons />
      </div>
      <BreadcrumbNavigation />
    </nav>
  )
}
```

## Error Handling

### 1. 404 Not Found Page
- **File**: `src/app/jobs/[id]/not-found.tsx`
```typescript
export default function JobNotFound() {
  return (
    <div className="text-center py-16">
      <h1 className="text-4xl font-bold text-gray-900 mb-4">Job Not Found</h1>
      <p className="text-gray-600 mb-8">
        The job you're looking for doesn't exist or has been removed.
      </p>
      <div className="space-x-4">
        <Link href="/jobs" className="btn-primary">
          Browse All Jobs
        </Link>
        <Link href="/" className="btn-secondary">
          Go Home
        </Link>
      </div>
    </div>
  )
}
```

### 2. Error Boundary
- **File**: `src/app/jobs/[id]/error.tsx`
```typescript
'use client'

export default function JobDetailError({
  error,
  reset,
}: {
  error: Error & { digest?: string }
  reset: () => void
}) {
  return (
    <div className="text-center py-16">
      <h1 className="text-4xl font-bold text-red-600 mb-4">Something went wrong</h1>
      <p className="text-gray-600 mb-8">
        Unable to load job details. Please try again.
      </p>
      <button onClick={reset} className="btn-primary">
        Try Again
      </button>
    </div>
  )
}
```

### 3. Loading States
- **File**: `src/app/jobs/[id]/loading.tsx`
```typescript
export default function JobDetailLoading() {
  return (
    <div className="max-w-4xl mx-auto animate-pulse">
      <div className="border-b pb-6 mb-8">
        <div className="h-8 bg-gray-300 rounded w-3/4 mb-4"></div>
        <div className="h-6 bg-gray-300 rounded w-1/2 mb-4"></div>
        <div className="flex gap-4">
          <div className="h-6 bg-gray-300 rounded w-20"></div>
          <div className="h-6 bg-gray-300 rounded w-24"></div>
        </div>
      </div>
      <div className="space-y-4">
        <div className="h-4 bg-gray-300 rounded w-full"></div>
        <div className="h-4 bg-gray-300 rounded w-5/6"></div>
        <div className="h-4 bg-gray-300 rounded w-4/6"></div>
      </div>
    </div>
  )
}
```

## SEO & Performance Optimization

### 1. Metadata Generation
- Dynamic title and description based on job content
- Open Graph tags for social sharing
- Canonical URLs for duplicate content prevention
- JSON-LD structured data for search engines

### 2. Static Generation
```typescript
export const revalidate = 3600 // Revalidate every hour

export async function generateStaticParams() {
  // Generate static params for ISR
  const jobs = await getAllJobIds()
  return jobs.map(id => ({ id }))
}
```

### 3. Content Optimization
- HTML sanitization for job descriptions
- Image optimization for company logos
- Lazy loading for non-critical content
- Proper semantic HTML structure

## UI/UX Specifications

### Desktop Layout
```
Job Detail Page Layout:
┌─────────────────────────────────────────┐
│ [← Back to Jobs]              [Share ▼] │
│                                         │
│ Senior Frontend Developer               │
│ TechCorp Inc.                          │
│ 🏢 Full-Time  📍 San Francisco         │
│ Posted 3 days ago                      │
├─────────────────────────────────────────┤
│ Job Description                         │
│                                         │
│ Lorem ipsum dolor sit amet, consectetur │
│ adipiscing elit. Sed do eiusmod tempor  │
│ incididunt ut labore et dolore magna    │
│ aliqua...                               │
│                                         │
├─────────────────────────────────────────┤
│ [Apply Now] [Save Job] [Share]          │
│                                         │
│ Report this job                         │
└─────────────────────────────────────────┘
```

### Mobile Layout
- Single column responsive design
- Sticky apply button at bottom
- Collapsible sections for long content
- Touch-friendly navigation

### Typography & Spacing
- **Job Title**: H1, 32px, bold
- **Company**: H2, 24px, semi-bold
- **Description**: 16px line height 1.6
- **Badges**: 12px, rounded corners
- **Margins**: 24px between sections

## Share Functionality

### 1. Share Options
- **Copy Link**: Copy job URL to clipboard
- **Email**: Open email client with pre-filled subject/body
- **Social Media**: Twitter, LinkedIn integration
- **Native Share**: Use Web Share API where available

### 2. Share Component
- **File**: `src/components/jobs/share-button.tsx`
```typescript
export function ShareButton({ job }: { job: Job }) {
  const shareData = {
    title: `${job.title} at ${job.company}`,
    text: job.description.substring(0, 100) + '...',
    url: `/jobs/${job.id}`
  }
  
  const handleShare = async () => {
    if (navigator.share) {
      await navigator.share(shareData)
    } else {
      // Fallback to custom share modal
      openShareModal(shareData)
    }
  }
  
  return (
    <button onClick={handleShare} className="btn-secondary">
      Share Job
    </button>
  )
}
```

## Accessibility Requirements

### 1. Semantic Structure
- Proper heading hierarchy (H1 → H6)
- Article and section landmarks
- Navigation landmarks
- Main content identification

### 2. Keyboard Navigation
- All interactive elements keyboard accessible
- Logical tab order
- Focus indicators
- Skip links for long content

### 3. Screen Reader Support
- Alt text for images and icons
- ARIA labels for complex UI elements
- Live regions for dynamic content
- Descriptive link text

## Testing Strategy

### 1. Unit Tests
```typescript
// __tests__/job-detail-page.test.tsx
describe('Job Detail Page', () => {
  it('should render job details correctly', () => {
    // Test component rendering
  })
  
  it('should handle missing job gracefully', () => {
    // Test 404 handling
  })
  
  it('should generate proper metadata', () => {
    // Test SEO metadata generation
  })
})
```

### 2. Integration Tests
- Test database queries with various job IDs
- Test error handling for invalid IDs
- Test share functionality

### 3. E2E Tests
- Navigate from job list to job detail
- Test back navigation
- Test share functionality
- Test mobile responsive behavior
- Test loading and error states

## Implementation Steps

### Phase 1: Core Structure (2 days)
1. Set up dynamic route structure
2. Create database query functions
3. Build main job detail component
4. Implement basic error handling

### Phase 2: Enhanced Features (2 days)
1. Add share functionality
2. Implement navigation components
3. Add loading and error states
4. SEO optimization and metadata

### Phase 3: Polish & Testing (1 day)
1. Accessibility improvements
2. Performance optimizations
3. Comprehensive testing
4. Mobile responsiveness
5. Animation and transitions

## Dependencies
- Next.js 15 App Router with dynamic routes
- Supabase for database queries
- HTML sanitization library (DOMPurify)
- React components for UI
- Tailwind CSS for styling
- TypeScript for type safety

## Estimated Timeline
**Total**: 5 days
- **Phase 1**: 2 days
- **Phase 2**: 2 days
- **Phase 3**: 1 day