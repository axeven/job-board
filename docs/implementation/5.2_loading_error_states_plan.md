# 5.2 Loading & Error States Implementation Plan

## Overview
Implement comprehensive loading and error state management to provide excellent user experience during data fetching, form submissions, and error conditions.

## Objectives
- Create skeleton loaders for data fetching states
- Implement loading spinners for form submissions
- Add toast notification system for success/error messages
- Create error boundaries for crash recovery
- Ensure graceful degradation and user feedback

## Technical Implementation

### 5.2.1 Skeleton Loading Components
**Files to Create:**
- `src/components/ui/skeleton.tsx`
- `src/components/loading/job-card-skeleton.tsx`
- `src/components/loading/job-list-skeleton.tsx`
- `src/components/loading/dashboard-skeleton.tsx`

**Implementation Steps:**

1. **Base Skeleton Component**
   ```typescript
   interface SkeletonProps {
     className?: string
     variant?: 'text' | 'rectangular' | 'circular'
     animation?: 'pulse' | 'wave' | 'none'
     width?: string | number
     height?: string | number
   }
   
   export function Skeleton({ 
     className,
     variant = 'rectangular',
     animation = 'pulse',
     width,
     height
   }: SkeletonProps) {
     // Tailwind-based skeleton with shimmer animation
   }
   ```

2. **Job-Specific Skeleton Loaders**
   ```typescript
   // JobCardSkeleton for job listings
   export function JobCardSkeleton() {
     return (
       <div className="border rounded-lg p-4 space-y-3">
         <Skeleton variant="text" width="75%" height="1.5rem" />
         <Skeleton variant="text" width="50%" height="1rem" />
         <Skeleton variant="rectangular" width="100%" height="3rem" />
         <div className="flex gap-2">
           <Skeleton variant="rectangular" width="4rem" height="1.5rem" />
           <Skeleton variant="rectangular" width="6rem" height="1.5rem" />
         </div>
       </div>
     )
   }
   ```

3. **Page-Level Skeleton Layouts**
   - Job listing page skeleton
   - Dashboard skeleton
   - Job detail page skeleton
   - Form skeleton states

### 5.2.2 Loading Spinners & Indicators
**Files to Create:**
- `src/components/ui/loading-spinner.tsx`
- `src/components/ui/loading-button.tsx`
- `src/components/ui/progress-bar.tsx`

**Implementation Steps:**

1. **Spinner Component Variants**
   ```typescript
   interface LoadingSpinnerProps {
     size?: 'sm' | 'md' | 'lg' | 'xl'
     color?: 'primary' | 'secondary' | 'white'
     className?: string
   }
   
   export function LoadingSpinner({ 
     size = 'md', 
     color = 'primary',
     className 
   }: LoadingSpinnerProps) {
     // SVG-based spinner with Tailwind animations
   }
   ```

2. **Button Loading States**
   ```typescript
   interface LoadingButtonProps extends ButtonProps {
     isLoading?: boolean
     loadingText?: string
     loadingSpinner?: boolean
   }
   
   export function LoadingButton({
     isLoading,
     loadingText,
     loadingSpinner = true,
     children,
     disabled,
     ...props
   }: LoadingButtonProps) {
     return (
       <Button disabled={isLoading || disabled} {...props}>
         {isLoading && loadingSpinner && (
           <LoadingSpinner size="sm" className="mr-2" />
         )}
         {isLoading ? loadingText || 'Loading...' : children}
       </Button>
     )
   }
   ```

3. **Global Loading States**
   - Page transition indicators
   - Navigation loading states
   - Form submission feedback
   - File upload progress

### 5.2.3 Toast Notification System
**Files to Create:**
- `src/components/ui/toast.tsx`
- `src/lib/toast-context.tsx`
- `src/hooks/use-toast.ts`
- `src/components/ui/toast-container.tsx`

**Implementation Steps:**

1. **Toast Component**
   ```typescript
   interface ToastProps {
     id: string
     type: 'success' | 'error' | 'warning' | 'info'
     title: string
     description?: string
     duration?: number
     onClose: (id: string) => void
   }
   
   export function Toast({
     id,
     type,
     title,
     description,
     duration = 5000,
     onClose
   }: ToastProps) {
     // Auto-dismiss logic with useEffect
     // Toast styling with appropriate icons and colors
   }
   ```

2. **Toast Context & Provider**
   ```typescript
   interface ToastContextType {
     toasts: Toast[]
     addToast: (toast: Omit<Toast, 'id' | 'onClose'>) => void
     removeToast: (id: string) => void
     clearToasts: () => void
   }
   
   export const ToastProvider = ({ children }: { children: React.ReactNode }) => {
     const [toasts, setToasts] = useState<Toast[]>([])
     // Toast management logic
   }
   ```

3. **Toast Hook**
   ```typescript
   export function useToast() {
     const context = useContext(ToastContext)
     
     const toast = useMemo(() => ({
       success: (message: string, description?: string) => 
         context.addToast({ type: 'success', title: message, description }),
       error: (message: string, description?: string) => 
         context.addToast({ type: 'error', title: message, description }),
       warning: (message: string, description?: string) => 
         context.addToast({ type: 'warning', title: message, description }),
       info: (message: string, description?: string) => 
         context.addToast({ type: 'info', title: message, description }),
     }), [context])
     
     return { toast }
   }
   ```

### 5.2.4 Error Boundary Implementation
**Files to Create:**
- `src/components/error/error-boundary.tsx`
- `src/components/error/error-fallback.tsx`
- `src/components/error/not-found.tsx`

**Implementation Steps:**

1. **Error Boundary Component**
   ```typescript
   interface ErrorBoundaryState {
     hasError: boolean
     error?: Error
     errorInfo?: ErrorInfo
   }
   
   export class ErrorBoundary extends Component<
     { children: ReactNode; fallback?: ComponentType<any> },
     ErrorBoundaryState
   > {
     constructor(props: any) {
       super(props)
       this.state = { hasError: false }
     }
     
     static getDerivedStateFromError(error: Error): ErrorBoundaryState {
       return { hasError: true, error }
     }
     
     componentDidCatch(error: Error, errorInfo: ErrorInfo) {
       // Log error to monitoring service
       console.error('Error caught by boundary:', error, errorInfo)
     }
     
     render() {
       if (this.state.hasError) {
         return this.props.fallback ? 
           <this.props.fallback error={this.state.error} /> :
           <ErrorFallback error={this.state.error} />
       }
       
       return this.props.children
     }
   }
   ```

2. **Error Fallback Components**
   ```typescript
   interface ErrorFallbackProps {
     error?: Error
     resetError?: () => void
   }
   
   export function ErrorFallback({ error, resetError }: ErrorFallbackProps) {
     return (
       <div className="flex flex-col items-center justify-center p-8 text-center">
         <h2 className="text-2xl font-bold mb-4">Something went wrong</h2>
         <p className="text-gray-600 mb-6">
           We apologize for the inconvenience. Please try again.
         </p>
         {resetError && (
           <Button onClick={resetError}>Try Again</Button>
         )}
       </div>
     )
   }
   ```

3. **Specific Error Pages**
   - 404 Not Found component
   - Network error fallback
   - Permission denied fallback
   - Generic error fallback

### 5.2.5 Loading & Error State Integration
**Files to Update:**
- `src/app/jobs/page.tsx`
- `src/app/dashboard/jobs/page.tsx`
- `src/components/jobs/job-creation-form.tsx`
- `src/components/dashboard/job-actions-menu.tsx`

**Implementation Steps:**

1. **Server Component Loading States**
   ```typescript
   export default async function JobsPage() {
     return (
       <Suspense fallback={<JobListSkeleton />}>
         <JobsList />
       </Suspense>
     )
   }
   ```

2. **Client Component Loading Integration**
   ```typescript
   export function JobCreationForm() {
     const [isSubmitting, setIsSubmitting] = useState(false)
     const { toast } = useToast()
     
     const handleSubmit = async (data: JobFormData) => {
       try {
         setIsSubmitting(true)
         await createJob(data)
         toast.success('Job created successfully!')
       } catch (error) {
         toast.error('Failed to create job', error.message)
       } finally {
         setIsSubmitting(false)
       }
     }
     
     return (
       <form onSubmit={handleSubmit}>
         {/* Form fields */}
         <LoadingButton 
           isLoading={isSubmitting}
           loadingText="Creating Job..."
           type="submit"
         >
           Create Job
         </LoadingButton>
       </form>
     )
   }
   ```

## File Structure
```
src/
├── components/
│   ├── ui/
│   │   ├── skeleton.tsx
│   │   ├── loading-spinner.tsx
│   │   ├── loading-button.tsx
│   │   ├── toast.tsx
│   │   └── toast-container.tsx
│   ├── loading/
│   │   ├── job-card-skeleton.tsx
│   │   ├── job-list-skeleton.tsx
│   │   └── dashboard-skeleton.tsx
│   └── error/
│       ├── error-boundary.tsx
│       ├── error-fallback.tsx
│       └── not-found.tsx
├── lib/
│   └── toast-context.tsx
└── hooks/
    └── use-toast.ts
```

## Implementation Checklist

### Phase 5.2.1: Skeleton Loaders
- [ ] Create base Skeleton component with variants
- [ ] Implement JobCardSkeleton for job listings
- [ ] Create JobListSkeleton for full page loading
- [ ] Add DashboardSkeleton for dashboard pages
- [ ] Test skeleton animations and responsiveness

### Phase 5.2.2: Loading Indicators
- [ ] Implement LoadingSpinner with size variants
- [ ] Create LoadingButton component
- [ ] Add progress indicators for long operations
- [ ] Integrate loading states in forms
- [ ] Test loading states across browsers

### Phase 5.2.3: Toast System
- [ ] Build Toast component with all variants
- [ ] Implement ToastProvider and context
- [ ] Create useToast hook
- [ ] Add ToastContainer for positioning
- [ ] Test toast auto-dismiss and stacking

### Phase 5.2.4: Error Boundaries
- [ ] Implement ErrorBoundary class component
- [ ] Create ErrorFallback components
- [ ] Add specific error page variants
- [ ] Test error recovery mechanisms
- [ ] Integrate with error logging

### Phase 5.2.5: Integration
- [ ] Add Suspense boundaries to pages
- [ ] Update forms with loading states
- [ ] Integrate toast notifications
- [ ] Add error boundaries to route segments
- [ ] Test complete user flows

## Testing Strategy
1. **Loading State Testing**
   - Test skeleton loaders with slow network simulation
   - Verify loading indicators during form submissions
   - Check loading states across different screen sizes

2. **Error Scenario Testing**
   - Test error boundaries with thrown errors
   - Verify network error handling
   - Check graceful degradation scenarios

3. **Toast Notification Testing**
   - Test toast positioning and stacking
   - Verify auto-dismiss functionality
   - Check accessibility of notifications

## Success Criteria
- [ ] All data loading states show appropriate skeletons
- [ ] Form submissions provide clear loading feedback
- [ ] Toast notifications work for all success/error scenarios
- [ ] Error boundaries prevent application crashes
- [ ] Loading states are accessible and performant
- [ ] User feedback is immediate and clear
- [ ] Error recovery mechanisms work properly

## Estimated Timeline
- **Skeleton Loaders**: 1 day
- **Loading Indicators**: 0.5 day
- **Toast System**: 1 day
- **Error Boundaries**: 0.5 day
- **Integration & Testing**: 1 day

**Total: 4 days**